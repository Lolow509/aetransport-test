<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paiement réussi</title>
  <link rel="icon" type="image/png" href="/aetransport-test/black_logo.png">

  <!-- Police proche Uber -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000;
      color: #fff;
    }

    .container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 32px 20px 24px;
    }

    /* Check icon */
    .check-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 60px;
    }

    .check-circle {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      background: #1dbf73;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .check {
      width: 32px;
      height: 18px;
      border-left: 4px solid #fff;
      border-bottom: 4px solid #fff;
      transform: rotate(-45deg);
      margin-bottom: 6px;
    }

    /* Text */
    .content {
      text-align: center;
      margin-top: 32px;
    }

    .content h1 {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .content p {
      font-size: 16px;
      color: #b3b3b3;
      margin: 0;
    }

    .sub {
      margin-top: 8px;
      font-size: 14px;
      color: #8e8e8e;
      line-height: 1.4;
      text-align: center;
    }

    /* Card recap */
    .card {
      background: #111;
      border-radius: 16px;
      padding: 20px;
      margin-top: 40px;
    }

    .row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 15px;
    }

    .row:last-child {
      margin-bottom: 0;
    }

    .label {
      color: #b3b3b3;
    }

    .value {
      font-weight: 600;
    }

    /* Button */
    .footer {
      margin-top: 40px;
    }

    .btn {
      width: 100%;
      padding: 16px;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn:active {
      transform: scale(0.98);
    }


    /* Cancel icon */
   .cancel-circle {
     width: 96px;
     height: 96px;
     border-radius: 50%;
     background: #e11900;
     display: flex;
     align-items: center;
     justify-content: center;
     position: relative;
   }

   .cancel-circle::before,
   .cancel-circle::after {
     content: '';
     position: absolute;
     width: 36px;
     height: 4px;
     background: #fff;
     border-radius: 2px;
   }

   .cancel-circle::before {
     transform: rotate(45deg);
   }

   .cancel-circle::after {
     transform: rotate(-45deg);
   }


   @media screen and (min-width: 800px) {
     .container {
       margin:0px 300px
     }

     .sub {
        font-size: 15px;
      }
   }


/*Wait Box*/
   .wait-screen {
  position: fixed;
  inset: 0;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.spinner {
  width: 48px;
  height: 48px;
  border: 2px solid rgba(255,255,255,0.2);
  border-top: 2px solid #fff;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-bottom: 16px;
}

.wait-screen p {
  color: #b3b3b3;
  font-size: 15px;
  font-weight: 500;
  letter-spacing: 0.2px;
}

/* Animation */
@keyframes spin {
  to { transform: rotate(360deg); }
}

.wait-screen {
  animation: fadeIn 0.25s ease;
}

@keyframes fadeIn {
  from { opacity: 0 }
  to { opacity: 1 }
}



/* bouton test */
.action-buttons {
  display: flex;
  gap: 12px;
  margin-top: 32px;
}

.action-buttons button {
  flex: 1;
  padding: 14px 0;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 600;
  border: none;
  cursor: pointer;
}

/* Bouton accueil */
.btn-secondary {
  background: #6f6d6d;
  color: #fff;
}

/* Bouton réessayer */
.btn-primary {
  background: #fff;
  color: #000;
}

.action-buttons button:active {
  transform: scale(0.97);
}



    /**header**/


   header {
      background-color: #111;
      color: white;
      padding-top: 10px;
      /*padding-left: 20px;
      padding-right: 20px;*/
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 999;
    }

    .navbar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-width: 1200px;
      margin: auto;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      align-items: center;
      display: flex; 
      gap: 20px;
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 20px;
     align-items: center;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      font-size: 1rem;
      transition: color 0.3s;
    }

    .nav-links a:hover {
      color: #e91e63;
    }

    .burger {
      display: none;
      flex-direction: column;
      cursor: pointer;
      gap: 4px;
    }

    .burger div {
      width: 25px;
      height: 3px;
      background-color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero {
       margin-top: 60px !important;
     }
      
    .hero h1{
      font-size: xx-large !important;
     }
     
      .nav-links {
        position: absolute;
        top: 30px;
        right: 0;
        background-color: #111;
        flex-direction: column;
        width: 100%;
        display: none;
        align-items: flex-start;
      }

      .nav-links.active {
        display: flex;
       padding-top: 20px;
       /*margin-right: -30px;*/
       height: 230px;
        padding-left: 20px;
        margin-top: 15px;
      }

      .burger {
        display: flex;
      }


     header {
          padding-bottom: 10px;
     }

      details p {
        margin-left: 10px !important;
      }
    }
    
    .main {
      padding-top: 70px; /* pour ne pas cacher le contenu sous la nav fixe */
    }

  
    .hero {
      position: relative;
      height: 15vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      margin-top: 60px;
    }

    .hero video,
    .hero img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
      border-bottom-right-radius : 20px;
      border-bottom-left-radius :20px;
    }

    .overlay {
      background: rgba(0, 0, 0, 0.6); /* assombrit pour que le texte ressorte */
      /*border-radius: 20px;*/
      border-bottom-right-radius : 20px;
      border-bottom-left-radius :20px;
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      z-index: 0;
    }

    .hero-content {
      z-index: 1;
      padding: 20px;
    }

    .hero h1 {
      font-size: 3em;
      margin: 0;
    }

    .hero p {
      font-size: 15px;
      margin: 10px 0;
    }

    .hero .location {
      font-size: 15px;
      margin-bottom: 40px;
    }

    .hero .cta-button {
      background-color: #fff;
      color: black;
      padding: 10px 15px;
      font-size: 1.2em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s ease;
    }

    .hero .cta-button:hover {
      background-color: #000000;
      color : #fff;
    }





  </style>
</head>
<body>

  <div id="wait-screen" class="wait-screen">
  <div class="spinner"></div>
  <p>Patientez…</p>
</div>


  
<header>
    <div class="navbar">
      <div class="logo" onclick="location.href='/aetransport-test' ">
       <img id="logoHead" src="/aetransport-test/white_logo.png" style="width: 50px;">
       A.E TRANSPORT
      </div>
      <ul class="nav-links" id="nav-links">
        <li><a href="/aetransport-test/a_propos.html">A propos</a></li>
        <li><a href="/aetransport-test/flottes.html">Notre flotte</a></li>
        <li><a href="/aetransport-test/faq.html">FAQ</a></li>
        <li><a href="/aetransport-test/contact.html">Contact</a></li>
        <li><a id="reserveLink" href="/aetransport-test/reservation.html" style="background: #ffffff;color: #FF5722;padding: 10px 20px;border-radius:10px;text-decoration:none;font-weight:600;display:flex;align-items:center;gap:10px;width: fit-content;">Réserver</a></li>
      </ul>
      <div class="burger" id="burger" style="display:none">
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
  </header>




  <!-- Texte header -->
<div class="hero" style="display:none"> 
    <img src="https://storage.googleapis.com/pod_public/1300/126525.jpg" 
           alt="Photo vue panoramique de Paris" 
           style="width:100%; box-shadow:0 8px 20px rgba(0,0,0,0.1);animation:floatImg 5s ease-in-out infinite;">

    <!-- Filtre sombre -->
    <div class="overlay"></div>

    <!-- Contenu -->
    <div class="hero-content">
      <h1>Réservation</h1>
    </div>
  </div>
 <!-- Fin texte header -->






  


<div class="container">

  <div>
    <div class="check-wrapper">
      <div id="check" class="check-circle">
        <div class="check"></div>
      </div>
    </div>

    <div class="content">
      <h1 id="check_pay">Paiement effectué</h1>
      <p id="text_pay">Merci <span id="nom_client"></span> pour votre réservation</p>
      <p id="subText_pay" style="display: none" class="sub">Vous pouvez réessayer et choisir un autre moyen de paiement.</p>
    </div>

    <div class="card">
      <div class="row">
        <span class="label">Montant payé</span>
        <span class="value" id="pay_client">20,00 €</span>
      </div>
      <!-- <div class="row">
        <span class="label">Mode de paiement</span>
        <span class="value" id="modePay_client">Carte bancaire</span>
      </div> -->
      <div class="row">
        <span class="label">Référence</span>
        <span class="value" id="ref_client">#CMD-45892</span>
      </div>
    </div>
  </div>

  <div class="footer">
      <div id="back_home" class="">
        <button class="btn" onclick="goHome()">Retour à l’accueil</button>
      </div>

      <div id="retry_pay" class="action-buttons">
        <button class="btn-secondary" onclick="goHome()">
          Accueil
        </button>

        <button class="btn-primary" id="retry_btn" >
          Réessayer
        </button>
      </div>

  </div>

</div>

<script>


      const scriptURL = "https://script.google.com/macros/s/AKfycbxyk54UTxMehWUltlxDQv7L5dL4MavAygoH5bttxSZd3BQ_q4JmCONTUToyhcAoyfzDmA/exec"



  //cs_test_a13D59Z8Nuf6bWPQNQExM3iCYA04lvBKVWw29AR56HDBsJXaFbwB48LvIa = paiement annulé
  //cs_test_a1bcqiW96Qpjs010IlZTreNZid6EJfMdGOIDoDow8ZF6chbN1UDQ3sF3SA = paiement accepter
  function goHome() {
    document.getElementById('wait-screen').style.display = 'flex';
    window.location.href = '/aetransport-test/reservation_2.html';
  }


  document.getElementById('wait-screen').style.display = 'flex';

  // Exemple : récupération du session_id Stripe
  const params = new URLSearchParams(window.location.search);
  const sessionId = params.get('session_id');
  const get_id = params.get('id');
  const get_name = params.get('name');
  const get_amount = params.get('amount');
  console.log('Stripe session:', sessionId);


if (sessionId) {


  const raw = "";

const requestOptions = {
  method: "POST",
  body: raw,
  redirect: "follow"
};

fetch(`${scriptURL}?session_id=${sessionId}&action=get_session_byStripe`, requestOptions)
  .then((response) => response.json())
  .then((result) =>{
    console.log(result)


    let amount_total = (result.amount_total / 100).toLocaleString('fr-FR', {
        style: 'currency',
        currency: 'EUR'
      });

    document.querySelector('#ref_client').innerText = result.metadata.order_id
    document.querySelector('#pay_client').innerText = amount_total
    document.querySelector('#nom_client').innerText = result.metadata.name


    if(result.status == "open"){
      document.querySelector('.check').remove();
      document.querySelector('#check').classList.add('cancel-circle')
      document.querySelector('#check').classList.remove('check-circle')
      document.querySelector('#check_pay').innerText = 'Paiement refusé';
      document.querySelector('#text_pay').innerText = 'Aucun montant n’a été débité.';
      document.querySelector('#subText_pay').style.display = "block"

      document.querySelector('#retry_btn').onclick = () => {
        window.location.href = result.url;
        };

        document.querySelector('#retry_pay').style.display = "flex"  //2 btns
        document.querySelector('#back_home').style.display = "none" //1 btn




    } else if (result.status == "expired"){

      document.querySelector('.check').remove();
      document.querySelector('#check').classList.add('cancel-circle')
      document.querySelector('#check').classList.remove('check-circle')
      document.querySelector('#check_pay').innerText = 'Paiement refusé';
      document.querySelector('#text_pay').innerText = 'Aucun montant n’a été débité.';
      document.querySelector('#subText_pay').style.display = "none"

      document.querySelector('#back_home').style.display = "block"  //1 btn
      document.querySelector('#retry_pay').style.display = "none"  //2 btns

    } else {
      document.querySelector('#subText_pay').style.display = "none"
      document.querySelector('#back_home').style.display = "block"  //1 btn
      document.querySelector('#retry_pay').style.display = "none"  //2 btns
    }


    document.getElementById('wait-screen').style.display = 'none';

  })
  .catch((error) => console.error(error));

} else {
  document.querySelector('#ref_client').innerText = get_id
  document.querySelector('#pay_client').innerText = get_amount +' €'
  document.querySelector('#nom_client').innerText = get_name

  document.querySelector('#check_pay').innerText = 'Réservation validée';

  document.querySelector('#subText_pay').style.display = "none"
  document.querySelector('#back_home').style.display = "block"  //1 btn
  document.querySelector('#retry_pay').style.display = "none"  //2 btns

  document.getElementById('wait-screen').style.display = 'none';
}



</script>

</body>
</html>

